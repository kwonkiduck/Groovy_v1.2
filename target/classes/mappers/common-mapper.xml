<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.groovy.common.CommonMapper">

    <resultMap type="employeeVO" id="employeeWithPhoto">
        <result property="emplId" column="EMPL_ID"/>
        <result property="emplNm" column="EMPL_NM"/>
        <result property="emplTelno" column="EMPL_TELNO"/>
        <result property="emplEmail" column="EMPL_EMAIL"/>
        <result property="emplBrthdy" column="EMPL_BRTHDY"/>
        <result property="commonCodeDept" column="COMMON_CODE_DEPT"/>
        <result property="commonCodeClsf" column="COMMON_CODE_CLSF"/>
        <result property="commonCodeHffcSttus" column="COMMON_CODE_HFFC_STTUS"/>
        <result property="proflPhotoFileStreNm" column="UPLOAD_FILE_STRE_NM"/>
    </resultMap>

    <select id="loadOrgChart" parameterType="String" resultMap="employeeWithPhoto">
        SELECT UF.UPLOAD_FILE_STRE_NM,
               E.EMPL_ID,
               E.EMPL_NM,
               E.EMPL_TELNO,
               E.EMPL_EMAIL,
               E.EMPL_ENCPN,
               E.EMPL_BRTHDY,
               E.COMMON_CODE_DEPT,
               E.COMMON_CODE_CLSF,
               E.COMMON_CODE_HFFC_STTUS
        FROM UPLOAD_FILE UF
                 JOIN PROFL P ON UF.UPLOAD_FILE_ETPR_CODE = P.PROFL_ETPR_CODE
                 JOIN EMPL E ON P.PROFL_EMPL_ID = E.EMPL_ID
        WHERE E.COMMON_CODE_DEPT = #{depCode}
        ORDER BY TO_NUMBER(SUBSTR(E.COMMON_CODE_CLSF, 5)), E.EMPL_ENCPN ASC
    </select>
</mapper>